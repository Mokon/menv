#!/bin/bash
# (C) 2013-2014 David 'Mokon' Bond, All Rights Reserved

if [ -f $menv_dir/.$menv_gen_tag ] ; then
  echo "menv is already installed on this computer. Not installing."
else 
  echo "Installing menv!"

  touch $menv_dir/.$menv_gen_tag
  menv_version set
  spushd .

  # Link the bash targets.
  cd ~
  safe_symlink $bashrc $menv_target_handler
  safe_symlink $bash_profile $menv_target_handler
  safe_symlink $bash_logout $menv_target_handler

  if [ -d ~/backup ] ; then
    echo "Restoring backup dir!"
    $RM -rf $menv_backup_dir
    $MV ~/backup $menv_backup_dir 
  fi

  if [ -d ~/local ] ; then
    echo "Restoring local dir!"
    $RM -rf $menv_local_dir
    $MV ~/local $menv_local_dir 
  fi

  if [ -f $menv_local_nonlogin ]; then
    echo "Found ${menv_local_nonlogin}."
  else
    echo "Didn't find ${menv_local_nonlogin}."
  fi

  if [ -f $menv_local_login ]; then
    echo "Found ${menv_local_login}."
  else
    echo "Didn't find ${menv_local_login}."
  fi

  # Link some files and dirs to the user home.
  safe_symlink ~/todo $menv_local_dir/todo 
  safe_symlink ~/cloud $menv_dir/cloud
  safe_symlink ~/docs $menv_local_dir/docs
  safe_symlink ~/pics $menv_local_dir/pics

  spopd

  menv_target_children install

  echo "Done installing menv!"

fi

