#!/bin/bash
# (C) 2013-2014 David 'Mokon' Bond, All Rights Reserved
  
# I like a large history size and I like a history that automatically saves
# itself after each command so if my shell terminates without a proper exit I
# can still find my last command. Each sesssions saves to that sessions history
# to a personal history file to get this done. On nonlogin I also scan all
# history files that exist. If their process does not exist then I append
# that file to the global history and delete the only session history. On exist
# the session history is flushed to the global history. Global history is loaded
# into the session history on first nonloign.
shopt -s nullglob
hs=${menv_logs_dir}/bash_history.*
for h in $hs ; do
  pid=${h##*.}
  if ! kill -0 $pid &> /dev/null ; then
    echo "menv session terminated without logout. Saving history!"
    cat $h >> ~/.bash_history
    rm $h
  fi
done
shopt -u nullglob

cp ~/.bash_history ${menv_logs_dir}/bash_history.${BASHPID}
menv_export HISTCONTROL=ignoredups:erasedups
menv_export HISTFILE=${menv_logs_dir}/bash_history.${BASHPID}
export PROMPT_COMMAND="${PROMPT_COMMAND:+$PROMPT_COMMAND$'\n'}history -a; history -c; history -r"
shopt -s histappend

menv_export HISTSIZE=100000
menv_export HISTFILESIZE=100000
menv_alias search_history="history | grep "
menv_alias sh=search_history

menv_function cd
function cd {
   # pushd here causes problems with scripts that require symmetry
   # pushd . &> /dev/null ;
   builtin cd $1
}

